# Lark-OCR-Sync 📅

**Lark-OCR-Sync** 是一个基于 Python 的非侵入式自动化工具，用于将飞书/Lark 桌面版客户端中的“个人考勤统计”数据提取并导出为本地 JSON 文件。

**核心升级**：采用 **“生产者-消费者”流水线架构 (Pipeline)**。利用 Python 多线程技术，实现了**“边截图、边识别”**。OCR 运算时间完全被 UI 等待时间“掩盖”，实现了**零延迟**的极致采集体验。

## ✨ 核心特性

* **🛡 非侵入式**：不注入进程，不抓包，完全模拟人类视觉和鼠标操作，安全合规。
* **🚀 流水线极速模式**：
* **主线程 (生产者)**：负责模拟鼠标点击与屏幕截图。
* **后台线程 (消费者)**：负责实时 OCR 识别与数据清洗。
* **效果**：当最后一张截图完成时，数据识别也几乎同步完成，无需额外等待。


* **🧠 轻量级 OCR**：使用 **RapidOCR (ONNXRuntime)**，模型常驻内存（只加载一次），彻底告别重复初始化带来的卡顿。
* **🎯 智能全自动**：
* **自动识月**：自动 OCR 识别日历左上角的“XXXX年XX月”，无需手动修改代码。
* **网格校准**：基于 Grid 算法计算坐标，精准定位每一天。


* **🖥 多屏支持**：使用 `mss` 库替代原生截图，完美支持多显示器、副屏截图。

## 🛠 技术栈

* **Python 3.8+**
* **RapidOCR**: 高性能离线 OCR 引擎 (ONNX)
* **Threading & Queue**: 多线程流水线处理
* **MSS**: 毫秒级屏幕截图
* **PyAutoGUI**: 鼠标自动化

## 📦 安装指南

1. **克隆或下载项目**
```bash
git clone https://github.com/wozouri/Lark-OCR-Sync.git
cd Lark-OCR-Sync

```


2. **安装依赖**
(环境已精简，无需安装 PaddlePaddle 或 PyTorch)
```bash
pip install -r requirements.txt

```



## 🚀 使用教程

### 第一步：智能校准 (首次运行必做)

由于不同电脑的分辨率和飞书布局不同，首次使用必须进行校准。

1. 打开 **飞书桌面端**，进入 **工作台 -> 考勤打卡 -> 统计 -> 个人统计**。
2. **【重要】将飞书窗口最大化（全屏）**。
3. 运行校准脚本：
```bash
python calibration.py

```


4. 按照终端提示，依次点击屏幕上的关键点：
* **Step 0 标题区**：框选左上角的“202X年X月”文字区域（左上角点一下，右下角点一下）。
* **Step 1 网格边缘**：日历某行的【最左侧一格(周日)】和【最右侧一格(周六)】。
* **Step 2 行间距**：下一行的【最左侧一格】。
* **Step 3 起始点**：日历上的数字【1】。
* **Step 4 详情区**：底部显示“已打卡”区域的范围。


5. 脚本运行结束后，会生成一段 `CONFIG = { ... }` 代码。
6. **复制** 这段代码，**覆盖** `main.py` 文件开头的 `CONFIG` 区域。

### 第二步：启动采集

1. 确保飞书窗口已打开。
2. 运行主程序：
```bash
python main.py

```


3. **运行流程**：
* 程序会自动识别当前月份（如 `2025-12`）。
* 鼠标开始自动点击每一天。
* **观察控制台**：你会看到截图进度（📸）和识别进度（⚡）交替刷屏，体验极度丝滑。


4. 结果将保存为 `attendance_2025-12.json`（文件名随月份自动变化）。

## 📂 输出数据示例

```json
[
  {
    "date": "2025-12-05",
    "check_in": "07:54",
    "check_out": "21:01",
    "raw_text": [
      "应上班09:00",
      "已打卡07:54极速打卡",
      "已打卡21:01"
    ]
  },
  {
    "date": "2025-12-06",
    "check_in": "09:01",
    "check_out": "",
    "raw_text": [
      "已打卡09:01",
      "缺卡"
    ]
  }
]

```

## ⚠️ 常见问题

**Q: 自动识别月份失败怎么办？**
A: 如果 OCR 无法识别标题（比如背景太复杂），程序会自动回退到“手动输入模式”，你可以在终端里直接输入 `2025-12` 继续运行。你也可以尝试重新运行 `calibration.py` 调整标题区的截取范围。

**Q: 点击位置偏了？**
A: 请确保运行 `calibration.py` 和 `main.py` 时，飞书窗口都是**最大化**状态。

## ⚖️ 免责声明

本项目仅供技术学习和个人数据备份使用。

* 请勿用于规避考勤监管或恶意用途。
* 代码完全开源，运行于本地，不会上传任何数据。

---

*Created by ZouYang*