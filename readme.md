# Lark-OCR-Sync 📅

**Lark-OCR-Sync** 是一个基于 Python 的非侵入式自动化工具，用于将飞书/Lark 桌面版客户端中的“个人考勤统计”数据提取并导出为本地 JSON 文件。

它利用屏幕自动化技术（PyAutoGUI）遍历日历，配合高性能 OCR 引擎（PaddleOCR）识别打卡时间，支持 **极速采集模式** 和 **多显示器跨屏截图**。

## ✨ 核心特性

* **🛡 非侵入式**：不注入进程，不抓包，完全模拟人类视觉和鼠标操作，安全合规。
* **⚡ 极速采集**：采用“采集-计算分离”架构，先极速截图（约 0.2s/天），后后台识别，体验流畅。
* **🖥 多屏支持**：使用 `mss` 库替代原生截图，完美支持多显示器、副屏截图，杜绝黑屏问题。
* **🧠 本地 OCR**：集成 PaddleOCR v5 模型，离线识别，无需上传图片，保护隐私。
* **🎯 自动校准**：附带交互式校准工具，适配不同分辨率和屏幕布局。

## 🛠 技术栈

* **Python 3.8+**
* **PaddleOCR**: 高精度中文 OCR 识别
* **MSS**: 跨平台高性能屏幕截图
* **PyAutoGUI**: 鼠标自动化控制
* **OpenCV**: 图像预处理（灰度/放大）

## 📦 安装指南

1. **克隆或下载项目**
```bash
git clone https://github.com/wozouri/Lark-OCR-Sync.git
cd Lark-OCR-Sync
```


2. **安装依赖**
建议使用虚拟环境（venv/conda）：
```bash
pip install -r requirements.txt
```



## 🚀 使用教程

### 第一步：坐标校准 (首次运行必做)

由于不同电脑的分辨率和飞书窗口位置不同，首次使用前必须校准坐标。

1. 打开 **飞书桌面端**，进入 **工作台 -> 考勤打卡 -> 统计 -> 个人统计**。
2. **【重要】将飞书窗口最大化（全屏）**。
3. 运行校准脚本：
```bash
python calibration.py
```


4. 按照终端提示，依次将鼠标移动到指定位置并按回车：
* 日历上的【1】号
* 日历上的【2】号
* 日历上的【8】号 (1号正下方)
* 底部详情区 (包含“已打卡”等文字的区域) 的左上角和右下角


5. 脚本结束后，会生成一段 `CONFIG = { ... }` 代码。
6. 复制这段代码，**覆盖** `main.py` 文件开头的 `CONFIG` 区域。

### 第二步：运行提取

1. 确保飞书窗口已打开（程序会自动将其前置并最大化）。
2. 运行主程序：
```bash
python main.py
```


3. **请勿移动鼠标**。程序将自动点击日历并截图（约 5-10 秒）。
4. 采集完成后，鼠标释放。程序将进入后台 OCR 识别阶段，此时你可以正常使用电脑。
5. 等待控制台输出 `✅ 全部完成`，数据将保存为当前目录下的 `monthly_attendance.json`。

## 📂 输出数据示例

生成的 `monthly_attendance.json` 格式如下：

```json
[
  {
    "date": "2025-12-01",
    "check_in": "08:55",
    "check_out": "18:05",
    "raw_text": ["应上班 09:00", "已打卡 08:55", "已打卡 18:05"]
  },
  {
    "date": "2025-12-02",
    "check_in": "09:01",
    "check_out": "",
    "raw_text": ["应上班 09:00", "已打卡 09:01", "缺卡"]
  }
]

```

## ⚠️ 常见问题

**Q: 截图是全黑的？**
A: 请确保你使用的是最新版代码（集成了 `mss` 库），并且在运行前已正确配置了校准坐标。

**Q: 点击位置不准，点到空白处了？**
A: 必须在**窗口最大化**的状态下进行校准 (`calibration.py`)，并且主程序运行时也会强制最大化窗口。如果窗口大小不一致，坐标就会偏移。

**Q: OCR 识别全是乱码或英文字母？**
A: 这是因为 PaddleOCR 误将噪点识别为英文。本项目已内置图像增强算法（2x 放大 + 灰度处理），确保使用 `main.py` 中的最新逻辑即可解决。

## ⚖️ 免责声明

本项目仅供技术学习和个人数据备份使用。

* 请勿用于规避考勤监管或恶意用途。
* 使用本工具产生的任何后果由使用者自行承担。

---

*Created by ZouYang with Gemini AI* 🤖